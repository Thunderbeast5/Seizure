// contexts/LanguageContext.tsx
import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';
import AsyncStorage from '@react-native-async-storage/async-storage';

// Define supported languages
export type Language = 'en' | 'es' | 'fr' | 'de' | 'hi' | 'ar';

export interface LanguageOption {
  code: Language;
  name: string;
  nativeName: string;
  flag: string;
}

export const SUPPORTED_LANGUAGES: LanguageOption[] = [
  { code: 'en', name: 'English', nativeName: 'English', flag: 'üá∫üá∏' },
  { code: 'es', name: 'Spanish', nativeName: 'Espa√±ol', flag: 'üá™üá∏' },
  { code: 'fr', name: 'French', nativeName: 'Fran√ßais', flag: 'üá´üá∑' },
  { code: 'de', name: 'German', nativeName: 'Deutsch', flag: 'üá©üá™' },
  { code: 'hi', name: 'Hindi', nativeName: '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä', flag: 'üáÆüá≥' },
  { code: 'ar', name: 'Arabic', nativeName: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', flag: 'üá∏üá¶' },
];

interface LanguageContextType {
  currentLanguage: Language;
  changeLanguage: (language: Language) => Promise<void>;
  t: (key: string) => string;
  isRTL: boolean;
}

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

const STORAGE_KEY = '@seizure_tracker_language';

interface LanguageProviderProps {
  children: ReactNode;
}

export const LanguageProvider: React.FC<LanguageProviderProps> = ({ children }) => {
  const [currentLanguage, setCurrentLanguage] = useState<Language>('en');

  // Load saved language on app start
  useEffect(() => {
    loadSavedLanguage();
  }, []);

  const loadSavedLanguage = async () => {
    try {
      const savedLanguage = await AsyncStorage.getItem(STORAGE_KEY);
      if (savedLanguage && SUPPORTED_LANGUAGES.find(lang => lang.code === savedLanguage)) {
        setCurrentLanguage(savedLanguage as Language);
      }
    } catch (error) {
      console.error('Error loading saved language:', error);
    }
  };

  const changeLanguage = async (language: Language) => {
    try {
      await AsyncStorage.setItem(STORAGE_KEY, language);
      setCurrentLanguage(language);
    } catch (error) {
      console.error('Error saving language:', error);
    }
  };

  const isRTL = currentLanguage === 'ar';

  // Translation function
  const t = (key: string): string => {
    return translations[currentLanguage]?.[key] || translations.en[key] || key;
  };

  const value: LanguageContextType = {
    currentLanguage,
    changeLanguage,
    t,
    isRTL,
  };

  return (
    <LanguageContext.Provider value={value}>
      {children}
    </LanguageContext.Provider>
  );
};

export const useLanguage = (): LanguageContextType => {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error('useLanguage must be used within a LanguageProvider');
  }
  return context;
};

// Translation strings
interface Translations {
  [key: string]: {
    [key: string]: string;
  };
}

const translations: Translations = {
  en: {
    // App Title
    seizure_tracker: 'Seizure Tracker',
    pediatric_seizure_monitoring: 'Pediatric Seizure Monitoring',
    
    // Menu
    menu: 'Menu',
    change_language: 'Change Language',
    
    // Main Features
    seizure_diary: 'Seizure Diary',
    seizure_diary_desc: 'Log and track seizures',
    medication_reminder: 'Medication Reminder',
    medication_reminder_desc: 'Track and set reminders',
    doctor_connect: 'Doctor Connect',
    doctor_connect_desc: 'Share data with doctors',
    education: 'Education',
    education_desc: 'Articles and tips',
    
    // Menu Items
    settings: 'Settings',
    help_support: 'Help & Support',
    about: 'About',
    logout: 'Logout',
    
    // Language Selection
    select_language: 'Select Language',
    current_language: 'Current Language',
    
    // Common
    cancel: 'Cancel',
    confirm: 'Confirm',
    ok: 'OK',
    
    // Alerts
    settings_coming_soon: 'Settings screen coming soon!',
    help_coming_soon: 'Help & Support coming soon!',
    about_coming_soon: 'About Seizure Tracker coming soon!',
    logout_coming_soon: 'Logout coming soon!',
    language_changed: 'Language changed successfully!',
    navigation_error: 'Navigation Error',
    could_not_navigate: 'Could not navigate to',
  },
  
  es: {
    // App Title
    seizure_tracker: 'Rastreador de Convulsiones',
    pediatric_seizure_monitoring: 'Monitoreo de Convulsiones Pedi√°tricas',
    
    // Menu
    menu: 'Men√∫',
    change_language: 'Cambiar Idioma',
    
    // Main Features
    seizure_diary: 'Diario de Convulsiones',
    seizure_diary_desc: 'Registrar y rastrear convulsiones',
    medication_reminder: 'Recordatorio de Medicaci√≥n',
    medication_reminder_desc: 'Rastrear y configurar recordatorios',
    doctor_connect: 'Conectar con Doctor',
    doctor_connect_desc: 'Compartir datos con doctores',
    education: 'Educaci√≥n',
    education_desc: 'Art√≠culos y consejos',
    
    // Menu Items
    settings: 'Configuraci√≥n',
    help_support: 'Ayuda y Soporte',
    about: 'Acerca de',
    logout: 'Cerrar Sesi√≥n',
    
    // Language Selection
    select_language: 'Seleccionar Idioma',
    current_language: 'Idioma Actual',
    
    // Common
    cancel: 'Cancelar',
    confirm: 'Confirmar',
    ok: 'OK',
    
    // Alerts
    settings_coming_soon: '¬°Pantalla de configuraci√≥n pr√≥ximamente!',
    help_coming_soon: '¬°Ayuda y soporte pr√≥ximamente!',
    about_coming_soon: '¬°Acerca del Rastreador de Convulsiones pr√≥ximamente!',
    logout_coming_soon: '¬°Cerrar sesi√≥n pr√≥ximamente!',
    language_changed: '¬°Idioma cambiado exitosamente!',
    navigation_error: 'Error de Navegaci√≥n',
    could_not_navigate: 'No se pudo navegar a',
  },

  fr: {
    // App Title
    seizure_tracker: 'Suivi des Crises',
    pediatric_seizure_monitoring: 'Surveillance des Crises P√©diatriques',
    
    // Menu
    menu: 'Menu',
    change_language: 'Changer la Langue',
    
    // Main Features
    seizure_diary: 'Journal des Crises',
    seizure_diary_desc: 'Enregistrer et suivre les crises',
    medication_reminder: 'Rappel de M√©dicament',
    medication_reminder_desc: 'Suivre et d√©finir des rappels',
    doctor_connect: 'Connexion M√©decin',
    doctor_connect_desc: 'Partager des donn√©es avec les m√©decins',
    education: '√âducation',
    education_desc: 'Articles et conseils',
    
    // Menu Items
    settings: 'Param√®tres',
    help_support: 'Aide et Support',
    about: '√Ä propos',
    logout: 'D√©connexion',
    
    // Language Selection
    select_language: 'S√©lectionner la Langue',
    current_language: 'Langue Actuelle',
    
    // Common
    cancel: 'Annuler',
    confirm: 'Confirmer',
    ok: 'OK',
    
    // Alerts
    settings_coming_soon: '√âcran des param√®tres bient√¥t disponible!',
    help_coming_soon: 'Aide et support bient√¥t disponible!',
    about_coming_soon: '√Ä propos du Suivi des Crises bient√¥t disponible!',
    logout_coming_soon: 'D√©connexion bient√¥t disponible!',
    language_changed: 'Langue chang√©e avec succ√®s!',
    navigation_error: 'Erreur de Navigation',
    could_not_navigate: 'Impossible de naviguer vers',
  },

  de: {
    // App Title
    seizure_tracker: 'Anfalls-Tracker',
    pediatric_seizure_monitoring: 'P√§diatrische Anfalls√ºberwachung',
    
    // Menu
    menu: 'Men√º',
    change_language: 'Sprache √Ñndern',
    
    // Main Features
    seizure_diary: 'Anfalls-Tagebuch',
    seizure_diary_desc: 'Anf√§lle protokollieren und verfolgen',
    medication_reminder: 'Medikamenten-Erinnerung',
    medication_reminder_desc: 'Verfolgen und Erinnerungen setzen',
    doctor_connect: 'Arzt-Verbindung',
    doctor_connect_desc: 'Daten mit √Ñrzten teilen',
    education: 'Bildung',
    education_desc: 'Artikel und Tipps',
    
    // Menu Items
    settings: 'Einstellungen',
    help_support: 'Hilfe & Support',
    about: '√úber',
    logout: 'Abmelden',
    
    // Language Selection
    select_language: 'Sprache Ausw√§hlen',
    current_language: 'Aktuelle Sprache',
    
    // Common
    cancel: 'Abbrechen',
    confirm: 'Best√§tigen',
    ok: 'OK',
    
    // Alerts
    settings_coming_soon: 'Einstellungsbildschirm kommt bald!',
    help_coming_soon: 'Hilfe & Support kommt bald!',
    about_coming_soon: '√úber Anfalls-Tracker kommt bald!',
    logout_coming_soon: 'Abmelden kommt bald!',
    language_changed: 'Sprache erfolgreich ge√§ndert!',
    navigation_error: 'Navigationsfehler',
    could_not_navigate: 'Konnte nicht navigieren zu',
  },

  hi: {
    // App Title
    seizure_tracker: '‡§¶‡•å‡§∞‡§æ ‡§ü‡•ç‡§∞‡•à‡§ï‡§∞',
    pediatric_seizure_monitoring: '‡§¨‡§æ‡§≤ ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§¶‡•å‡§∞‡§æ ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä',
    
    // Menu
    menu: '‡§Æ‡•á‡§®‡•Ç',
    change_language: '‡§≠‡§æ‡§∑‡§æ ‡§¨‡§¶‡§≤‡•á‡§Ç',
    
    // Main Features
    seizure_diary: '‡§¶‡•å‡§∞‡§æ ‡§°‡§æ‡§Ø‡§∞‡•Ä',
    seizure_diary_desc: '‡§¶‡•å‡§∞‡•á ‡§≤‡•â‡§ó ‡§î‡§∞ ‡§ü‡•ç‡§∞‡•à‡§ï ‡§ï‡§∞‡•á‡§Ç',
    medication_reminder: '‡§¶‡§µ‡§æ ‡§Ø‡§æ‡§¶‡§¶‡§æ‡§∂‡•ç‡§§',
    medication_reminder_desc: '‡§ü‡•ç‡§∞‡•à‡§ï ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§∞‡§ø‡§Æ‡§æ‡§á‡§Ç‡§°‡§∞ ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç',
    doctor_connect: '‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§ï‡§®‡•á‡§ï‡•ç‡§ü',
    doctor_connect_desc: '‡§°‡•â‡§ï‡•ç‡§ü‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§°‡•á‡§ü‡§æ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç',
    education: '‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ',
    education_desc: '‡§≤‡•á‡§ñ ‡§î‡§∞ ‡§∏‡•Å‡§ù‡§æ‡§µ',
    
    // Menu Items
    settings: '‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏',
    help_support: '‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§î‡§∞ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§®',
    about: '‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç',
    logout: '‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü',
    
    // Language Selection
    select_language: '‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç',
    current_language: '‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§≠‡§æ‡§∑‡§æ',
    
    // Common
    cancel: '‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
    confirm: '‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç',
    ok: '‡§†‡•Ä‡§ï ‡§π‡•à',
    
    // Alerts
    settings_coming_soon: '‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§ú‡§≤‡•ç‡§¶ ‡§Ü ‡§∞‡§π‡•Ä ‡§π‡•à!',
    help_coming_soon: '‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§î‡§∞ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§ú‡§≤‡•ç‡§¶ ‡§Ü ‡§∞‡§π‡§æ ‡§π‡•à!',
    about_coming_soon: '‡§¶‡•å‡§∞‡§æ ‡§ü‡•ç‡§∞‡•à‡§ï‡§∞ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ú‡§≤‡•ç‡§¶ ‡§Ü ‡§∞‡§π‡§æ ‡§π‡•à!',
    logout_coming_soon: '‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü ‡§ú‡§≤‡•ç‡§¶ ‡§Ü ‡§∞‡§π‡§æ ‡§π‡•à!',
    language_changed: '‡§≠‡§æ‡§∑‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡§¶‡§≤ ‡§ó‡§à!',
    navigation_error: '‡§®‡•á‡§µ‡•Ä‡§ó‡•á‡§∂‡§® ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø',
    could_not_navigate: '‡§®‡•á‡§µ‡•Ä‡§ó‡•á‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§∏‡§ï‡§æ',
  },

  ar: {
    // App Title
    seizure_tracker: 'ŸÖÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÜŸàÿ®ÿßÿ™',
    pediatric_seizure_monitoring: 'ŸÖÿ±ÿßŸÇÿ®ÿ© ÿßŸÑŸÜŸàÿ®ÿßÿ™ ŸÑŸÑÿ£ÿ∑ŸÅÿßŸÑ',
    
    // Menu
    menu: 'ÿßŸÑŸÇÿßÿ¶ŸÖÿ©',
    change_language: 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ©',
    
    // Main Features
    seizure_diary: 'ŸäŸàŸÖŸäÿßÿ™ ÿßŸÑŸÜŸàÿ®ÿßÿ™',
    seizure_diary_desc: 'ÿ™ÿ≥ÿ¨ŸäŸÑ Ÿàÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÜŸàÿ®ÿßÿ™',
    medication_reminder: 'ÿ™ÿ∞ŸÉŸäÿ± ÿßŸÑÿØŸàÿßÿ°',
    medication_reminder_desc: 'ÿ™ÿ™ÿ®ÿπ Ÿàÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ™ÿ∞ŸÉŸäÿ±ÿßÿ™',
    doctor_connect: 'ÿßÿ™ÿµÿßŸÑ ÿßŸÑÿ∑ÿ®Ÿäÿ®',
    doctor_connect_desc: 'ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿπ ÿßŸÑÿ£ÿ∑ÿ®ÿßÿ°',
    education: 'ÿßŸÑÿ™ÿπŸÑŸäŸÖ',
    education_desc: 'ŸÖŸÇÿßŸÑÿßÿ™ ŸàŸÜÿµÿßÿ¶ÿ≠',
    
    // Menu Items
    settings: 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
    help_support: 'ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ŸàÿßŸÑÿØÿπŸÖ',
    about: 'ÿ≠ŸàŸÑ',
    logout: 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨',
    
    // Language Selection
    select_language: 'ÿßÿÆÿ™ÿ± ÿßŸÑŸÑÿ∫ÿ©',
    current_language: 'ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©',
    
    // Common
    cancel: 'ÿ•ŸÑÿ∫ÿßÿ°',
    confirm: 'ÿ™ÿ£ŸÉŸäÿØ',
    ok: 'ŸÖŸàÿßŸÅŸÇ',
    
    // Alerts
    settings_coming_soon: 'ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÇÿ±Ÿäÿ®ÿßŸã!',
    help_coming_soon: 'ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ŸàÿßŸÑÿØÿπŸÖ ŸÇÿ±Ÿäÿ®ÿßŸã!',
    about_coming_soon: 'ÿ≠ŸàŸÑ ŸÖÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÜŸàÿ®ÿßÿ™ ŸÇÿ±Ÿäÿ®ÿßŸã!',
    logout_coming_soon: 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÇÿ±Ÿäÿ®ÿßŸã!',
    language_changed: 'ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ© ÿ®ŸÜÿ¨ÿßÿ≠!',
    navigation_error: 'ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ŸÜŸÇŸÑ',
    could_not_navigate: 'ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿ•ŸÑŸâ',
  },
};